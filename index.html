<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conway's Game of Life</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #1a1a1a;
            color: #eee;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        h1 {
            margin: 10px 0;
            font-size: 1.5rem;
            color: #4CAF50;
            text-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
        }

        .controls {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 8px 16px;
            cursor: pointer;
            background-color: #333;
            color: white;
            border: 1px solid #555;
            border-radius: 4px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        button:hover {
            background-color: #4CAF50;
            border-color: #4CAF50;
            color: white;
        }

        button.active {
            background-color: #d32f2f;
            border-color: #d32f2f;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #333;
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid #555;
        }

        canvas {
            border: 1px solid #333;
            background-color: #000;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            cursor: crosshair;
        }

        .stats {
            margin-top: 5px;
            font-size: 0.8rem;
            color: #888;
        }
    </style>
</head>
<body>

    <h1>Conway's Game of Life</h1>

    <div class="controls">
        <button id="startBtn">Start</button>
        <button id="randomBtn">Randomize</button>
        <button id="clearBtn">Clear</button>
        
        <div class="slider-container">
            <label for="speedRange">Speed:</label>
            <input type="range" id="speedRange" min="10" max="500" value="100" step="10">
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>
    <div class="stats">Generation: <span id="generation">0</span> | Click cells to toggle state</div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startBtn = document.getElementById('startBtn');
        const randomBtn = document.getElementById('randomBtn');
        const clearBtn = document.getElementById('clearBtn');
        const speedRange = document.getElementById('speedRange');
        const generationDisplay = document.getElementById('generation');

        // Configuration
        const resolution = 10; // Cell size in pixels
        let cols, rows;
        let grid;
        let animationId = null;
        let isRunning = false;
        let generation = 0;
        let speed = 100; // Initial speed delay (ms)
        let lastTime = 0;

        // Setup Canvas
        function setupCanvas() {
            // Set canvas size to approx 90% width and 75% height of window
            const width = Math.floor((window.innerWidth * 0.9) / resolution) * resolution;
            const height = Math.floor((window.innerHeight * 0.75) / resolution) * resolution;
            
            canvas.width = width;
            canvas.height = height;
            
            cols = width / resolution;
            rows = height / resolution;
            
            resetGrid();
        }

        // Create 2D Array
        function make2DArray(cols, rows) {
            let arr = new Array(cols);
            for (let i = 0; i < arr.length; i++) {
                arr[i] = new Array(rows).fill(0);
            }
            return arr;
        }

        // Reset/Initialize Grid
        function resetGrid(random = true) {
            grid = make2DArray(cols, rows);
            if (random) {
                for (let i = 0; i < cols; i++) {
                    for (let j = 0; j < rows; j++) {
                        grid[i][j] = Math.floor(Math.random() * 2);
                    }
                }
            }
            generation = 0;
            draw();
            updateStats();
        }

        // Draw function
        function draw() {
            ctx.fillStyle = '#000'; // Background
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#4CAF50'; // Cell color (Green)
            
            for (let i = 0; i < cols; i++) {
                for (let j = 0; j < rows; j++) {
                    let x = i * resolution;
                    let y = j * resolution;
                    
                    if (grid[i][j] === 1) {
                        ctx.fillRect(x, y, resolution - 1, resolution - 1);
                    }
                }
            }
        }

        // Compute Next Generation
        function computeNextGen() {
            let next = make2DArray(cols, rows);

            for (let i = 0; i < cols; i++) {
                for (let j = 0; j < rows; j++) {
                    let state = grid[i][j];
                    
                    // Count neighbors
                    let neighbors = countNeighbors(grid, i, j);

                    // Rules:
                    // 1. Underpopulation: < 2 neighbors -> dies
                    // 2. Overpopulation: > 3 neighbors -> dies
                    // 3. Reproduction: exactly 3 neighbors -> lives
                    // 4. Survival: 2 or 3 neighbors -> stays
                    
                    if (state === 0 && neighbors === 3) {
                        next[i][j] = 1;
                    } else if (state === 1 && (neighbors < 2 || neighbors > 3)) {
                        next[i][j] = 0;
                    } else {
                        next[i][j] = state;
                    }
                }
            }

            grid = next;
            generation++;
            updateStats();
        }

        // Count Neighbors (with wrapping)
        function countNeighbors(grid, x, y) {
            let sum = 0;
            for (let i = -1; i < 2; i++) {
                for (let j = -1; j < 2; j++) {
                    let col = (x + i + cols) % cols;
                    let row = (y + j + rows) % rows;
                    sum += grid[col][row];
                }
            }
            sum -= grid[x][y];
            return sum;
        }

        // Animation Loop
        function animate(currentTime) {
            if (!isRunning) return;

            animationId = requestAnimationFrame(animate);

            if (currentTime - lastTime >= speed) {
                computeNextGen();
                draw();
                lastTime = currentTime;
            }
        }

        function updateStats() {
            generationDisplay.innerText = generation;
        }

        // Event Listeners -------------------

        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const i = Math.floor(x / resolution);
            const j = Math.floor(y / resolution);

            if (i >= 0 && i < cols && j >= 0 && j < rows) {
                grid[i][j] = grid[i][j] ? 0 : 1;
                draw();
            }
        });

        startBtn.addEventListener('click', () => {
            isRunning = !isRunning;
            if (isRunning) {
                startBtn.textContent = 'Pause';
                startBtn.classList.add('active');
                lastTime = performance.now();
                animate(lastTime);
            } else {
                startBtn.textContent = 'Start';
                startBtn.classList.remove('active');
                cancelAnimationFrame(animationId);
            }
        });

        randomBtn.addEventListener('click', () => {
            resetGrid(true);
            if (!isRunning) draw();
        });

        clearBtn.addEventListener('click', () => {
            resetGrid(false);
            if (isRunning) {
                startBtn.click(); // Stop if running
            }
        });

        speedRange.addEventListener('input', (e) => {
            // Invert value so right is faster
            speed = 510 - parseInt(e.target.value);
        });

        window.addEventListener('resize', () => {
            if(confirm("Resize canvas to fit new window? (Current progress will be lost)")) {
                setupCanvas();
                if(isRunning) startBtn.click();
            }
        });

        // Initialize
        setupCanvas();
        speed = 510 - parseInt(speedRange.value);

    </script>
</body>
</html>
